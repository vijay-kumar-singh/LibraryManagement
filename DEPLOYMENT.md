# LibraryFlow Deployment Guide

## Deploying to Render

### Prerequisites
1. GitHub repository with your LibraryFlow code
2. Render account (free tier available)
3. Stripe account for payment processing

### Step 1: Prepare Environment Variables

You'll need to set up these environment variables in Render:

**Required Secrets:**
- `STRIPE_SECRET_KEY` - Your Stripe secret key (starts with `sk_`)
- `VITE_STRIPE_PUBLIC_KEY` - Your Stripe publishable key (starts with `pk_`)

**Auto-generated by Render:**
- `DATABASE_URL` - PostgreSQL connection string (auto-created)
- `SESSION_SECRET` - Session encryption key (auto-generated)

**Authentication (Optional for demo):**
- `REPLIT_DOMAINS` - Your render domain (e.g., `yourapp.onrender.com`)
- `REPL_ID` - Random ID for auth (can be any string)
- `ISSUER_URL` - Set to `https://replit.com/oidc`

### Step 2: Deploy Using render.yaml

1. Push your code to GitHub
2. Connect your GitHub repository to Render
3. Render will automatically detect the `render.yaml` file
4. The deployment will create:
   - Web service running the LibraryFlow application
   - PostgreSQL database with connection pooling

### Step 3: Manual Deployment (Alternative)

If you prefer manual setup:

1. **Create Web Service:**
   - Runtime: Docker
   - Build Command: `docker build -t libraryflow .`
   - Start Command: `docker run -p $PORT:5000 libraryflow`

2. **Create PostgreSQL Database:**
   - Go to Render dashboard → "New +" → "PostgreSQL"
   - Database Name: `libraryflow`
   - Region: Choose same as your web service
   - Plan: Free tier is fine for testing
   - Click "Create Database"
   - Copy the "External Database URL" from the database info page

3. **Environment Variables:**
   Add these in your web service Environment tab:
   ```
   DATABASE_URL=postgresql://user:password@host:port/database
   STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
   VITE_STRIPE_PUBLIC_KEY=pk_test_your_stripe_public_key
   SESSION_SECRET=your_random_32_character_secret
   ```
   - Use the **External Database URL** from step 2
   - Generate a strong random SESSION_SECRET

### Step 4: Post-Deployment Setup

1. **Database Schema:**
   The app will automatically create tables on first run.

2. **Sample Data:**
   The application includes sample books data that will be loaded automatically.

3. **Authentication:**
   For deployment without Replit Auth, the app uses a simple demo authentication system.
   Users can log in with demo credentials to test the system.

### Step 5: Getting Stripe Keys

1. Go to [Stripe Dashboard](https://dashboard.stripe.com/apikeys)
2. Copy your **Publishable key** for `VITE_STRIPE_PUBLIC_KEY`
3. Copy your **Secret key** for `STRIPE_SECRET_KEY`
4. For testing, use test keys (they start with `pk_test_` and `sk_test_`)

### Deployment Features

**Included in Deployment:**
- ✅ Complete React frontend with Vite build optimization
- ✅ Express.js backend with production configuration
- ✅ PostgreSQL database with automatic schema creation
- ✅ Stripe payment processing (requires your keys)
- ✅ Demo authentication system for testing
- ✅ Production-ready Docker configuration
- ✅ Health checks and auto-scaling

**Production Optimizations:**
- Docker multi-stage builds for smaller images
- Static file serving with proper caching
- Database connection pooling
- Security headers and HTTPS enforcement
- Error handling and logging

### Troubleshooting

**Common Issues:**

1. **Database Connection Errors:**
   - Verify `DATABASE_URL` is set correctly
   - Check database is running and accessible

2. **Stripe Payment Failures:**
   - Ensure both Stripe keys are set
   - Verify keys are for the correct environment (test/live)

3. **Authentication Issues:**
   - For Replit Auth: Set `REPLIT_DOMAINS` and `REPL_ID`
   - For demo mode: These can be left unset

4. **Build Failures:**
   - Check Docker build logs
   - Ensure all dependencies are installed

### Monitoring

Once deployed, monitor your application:
- Check Render dashboard for service health
- Monitor database performance and usage
- Review application logs for errors
- Set up alerts for critical issues

### Scaling

For production use:
- Upgrade to paid Render plans for better performance
- Use production Stripe keys
- Implement proper user authentication
- Add monitoring and analytics
- Set up backup strategies for your database

Your LibraryFlow application will be available at: `https://your-app-name.onrender.com`